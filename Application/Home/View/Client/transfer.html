<div class="container" style="margin-top: 81px">
    <div class="row text-center">

        <div class="col-xs-8 col-sm-4 col-sm-offset-3">
            <div class="form-group">
                <input type="text" id="namesearch" class="form-control" id="inputPassword2" name="name"
                       placeholder="请输入客户姓名">
            </div>
        </div>
        <div class="col-xs-4 col-sm-1">
            <button id="searchclient" class="btn btn-default"><span class="fa fa-search"></span> 查询客户</button>
        </div>
    </div>


</div>


<div class="container" style="margin-top: 20px">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">
            <div id="searchresult" class="table-responsive">

            </div>
        </div>
    </div>
</div>

<!--账单填写-->
<div class="container" style="margin-top: 30px;margin-bottom: 150px">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">

            <form id="payform" action="<{:U('Client/receive')}>" method="post">
                <div class="form-group">
                    <label for="exampleInputEmail1">客户编号 &nbsp;&nbsp;&nbsp;<span id="clientsname"
                                                                                 style="color:#00d600"></span></label>
                    <input type="text" class="form-control" id="exampleInputEmail1" name="uid" placeholder="请输入客户编号">
                </div>
                <div class="form-group">
                    <label for="">汇款金额</label>
                    <input type="text" class="form-control" name="amount" placeholder="请输入汇款金额">
                </div>

                <div class="form-group">
                    <label for="">存入账户</label>
                    <input type="text" class="form-control" name="account" placeholder="请输入账户" value="Client BOM">
                </div>

                <div class="form-group">
                    <label for="">存入方式</label>
                    <input type="text" class="form-control" name="type" placeholder="请输入存入方式" value="Transfer">
                </div>
                <div class="form-group">
                    <label for="">发票号码</label>
                    <input type="text" class="form-control" name="receipt" placeholder="请输入发票号码" value="/">
                </div>

                <div class="form-group">
                    <label for="dtp_input2" class=" control-label">汇款时间</label>
                    <div class="input-group date reg_time" data-date="" data-date-format="dd MM yyyy"
                         data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <input class="form-control" size="16" name="transfertime" type="text" value="" readonly>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                    </div>
                    <input type="hidden" id="dtp_input2"/><br/>
                </div>

                <div class="form-group">
                    <label for="">附注</label>
                    <input type="text" class="form-control" name="remark" placeholder="请写入附注" value="客户汇款">
                </div>


                <button type="submit" class="btn btn-primary"><span class="fa fa-check"></span> 确认提交</button>
            </form>
        </div>
    </div>
</div>


<script src="__PUBLIC__/js/jquery1.11.1.min.js"></script>
<script src="__PUBLIC__/dist/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/vendor/bootstrap-validator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/dist/js/bootstrap-datetimepicker.min.js" charset="UTF-8"></script>
<script src="__PUBLIC__/js/bootbox.min.js"></script>
<script>
    $(function () {
        $('#payform').bootstrapValidator({
            fields: {
                uid: {
                    validators: {
                        notEmpty: {
                            message: '请填写客户id'
                        },
                        numeric: {
                            message: '请输入数字'
                        },
                        remote: {//ajax验证。server result:{"valid",true or false} 向服务发送当前input name值，获得一个json数据。例表示正确：{"valid",true}
                            url: '<{:U("Pay/checkid")}>',//验证地址
                            message: '您输入的客户id不存在',//提示消息
                            type: 'GET',//请求方式
                            onSuccess: function (e, data) {
                                var name = data.result.name;
                                $('#clientsname').html(name);
                            },
                            onError: function (e, data) {
                                $('#clientsname').html('');
                            }
                        }
                    }
                },
                amount: {
                    validators: {
                        notEmpty: {
                            message: '金额不能为空'
                        },
                        numeric: {
                            message: '请输入数字'
                        }
                    }
                },
                account: {
                    validators: {
                        notEmpty: {
                            message: '请填写存入帐户'
                        },
                        stringLength: {
                            min: 1,
                            max: 20,
                            message: '存入帐户请为1-20位字符'
                        }
                    }
                },
                type: {
                    validators: {
                        notEmpty: {
                            message: '汇款方式不能为空'
                        },
                        stringLength: {
                            min: 1,
                            max: 20,
                            message: '汇款方式最多为20位字符'
                        }
                    }
                },
                remark: {
                    validators: {
                        notEmpty: {
                            message: '用途备注不能为空'
                        },
                        stringLength: {
                            min: 3,
                            max: 50,
                            message: '用途备注请为3-50位字符'
                        }
                    }
                },
            }
        });
        $('.reg_time').datetimepicker({
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0,
        });
        $('.reg_time').datetimepicker('update', new Date());
        $('.navbar-nav li:eq(7)').addClass('active');
        //绑定回车事件
        $(document).keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#namesearch').val()) {
                    $('#searchclient').trigger('click');
                }
            }
        })
        //查询结果绑定分页
        $('#searchresult').on('click', '.pagination li', function (e) {
            e.preventDefault();
            var url = $(this).children('a').eq(0).attr('href');
            if (url) {
                getid(url);
            }
        });
        //第一次查询
        $('#searchclient').click(function () {
            var clientname = $('#namesearch').val();
            if (!clientname) {
                bootbox.alert("请输入要查询的客户名字");
                return;
            }
            var url = '<{:U("Pay/search")}>' + '/name/' + encodeURI(encodeURI(clientname));
            getid(url);
        });

        function getid(url) {
            $.get(url, function (result) {
                $('#searchresult').html(result);
            });
        }
    });
</script>
