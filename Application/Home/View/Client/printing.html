<div class="container" style="margin-top: 81px">
    <div class="row text-center">

        <div class="col-xs-8 col-sm-3 col-sm-offset-3">
            <div class="form-group">
                <input type="text" id="namesearch" class="form-control" id="inputPassword2" name="name"
                       placeholder="请输入客户姓名">
            </div>
        </div>
        <div class="col-xs-4 col-sm-1">
            <button id="searchclient" class="btn btn-default"><span class="fa fa-search"></span> 查询客户</button>
        </div>
    </div>


</div>


<div class="container" style="margin-top: 20px">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">
            <div id="searchresult" class="table-responsive">

            </div>
        </div>
    </div>
</div>

<!--账单填写-->
<div class="container" style="margin-top: 30px;margin-bottom:200px">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">

            <form id="printform" action="<{:U('Client/produce')}>" method="post">
                <div class="form-group">
                    <label for="client_id">客户编号<span style="color:red">*</span> &nbsp;&nbsp;&nbsp;<span id="clientsname"
                                                                                                        style="color:#00d600"></span></label>
                    <input type="text" class="form-control" id="client_id" name="uid" placeholder="请输入客户编号">
                </div>

                <div class="form-group">
                    <label for="">Notes</label>
                    <textarea class="form-control" id='summernote' name="note" placeholder="如有需要 请填写note"></textarea>
                </div>


                <button type="submit" class="btn btn-primary"><span class="fa fa-print"></span> 保存Notes并打印</button>
            </form>
        </div>
    </div>
</div>


<script src="__PUBLIC__/js/jquery1.11.1.min.js"></script>
<script src="__PUBLIC__/dist/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/vendor/bootstrap-validator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/dist/js/bootstrap-datetimepicker.min.js" charset="UTF-8"></script>
<script src="__PUBLIC__/js/bootbox.min.js"></script>
<script src="__PUBLIC__/vendor/summernote/dist/summernote.min.js"></script>
<script src="__PUBLIC__/vendor/jquery-loading-master/dist/jquery.loading.js"></script>
<script language="JavaScript">
    javascript:window.history.forward(1);
</script>
<script>
    $(function () {
        $('#summernote').summernote({
            toolbar: [
                ['style', ['bold', 'italic', 'underline']],
                ['fontsize', ['fontsize']]
            ],
            height: '140px'
        });
        $('#printform').bootstrapValidator({
            fields: {
                uid: {
                    validators: {
                        notEmpty: {
                            message: '请填写客户id'
                        },
                        numeric: {
                            message: '请输入数字'
                        },
                        remote: {//ajax验证。server result:{"valid",true or false} 向服务发送当前input name值，获得一个json数据。例表示正确：{"valid",true}
                            url: '<{:U("Pay/checkid")}>',//验证地址
                            message: '您输入的客户id不存在',//提示消息
                            type: 'GET',//请求方式
                            onSuccess: function (e, data) {
                                var name = data.result.name;
                                $('#clientsname').html(name);
                            },
                            onError: function (e, data) {
                                $('#clientsname').html('');
                            },
                        }
                    }
                },
                time: {
                    validators: {
                        stringLength: {
                            max: 10,
                            message: '过户日期请不要超过10个字符'
                        }
                    }
                }
            }
        });


        $('.navbar-nav li:eq(4)').addClass('active');


        $("#client_id").bind('input porpertychange', function () {

            $('#summernote').summernote('code', '');

            if ($('#client_id').val() !== '') {
                var client_id = document.getElementById('client_id').value;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {

                    if (xhr.readyState == 4) {
                        var result = xhr.responseText;
                        result = JSON.parse(result);
                        $('#summernote').summernote('code', result.notes);

                        $('#summernote').loading('stop');
                    } else {
                        $('#summernote').loading();
                    }
                };
                var id = encodeURIComponent();
                var url = '<{:U("Client/getnotes")}>' + '?id=' + client_id;
                xhr.open('get', url);
                xhr.send(null);
            }
        });


        //绑定回车事件
        $(document).keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#namesearch').val()) {
                    $('#searchclient').trigger('click');
                }
            }
        })


        //查询结果绑定分页
        $('#searchresult').on('click', '.pagination li', function (e) {

            e.preventDefault();
            var url = $(this).children('a').eq(0).attr('href');
            if (url) {
                getid(url);
            }

        });


        //第一次查询
        $('#searchclient').click(function () {
            var clientname = $('#namesearch').val();
            if (clientname == '') {
                bootbox.alert("请输入要查询的客户名字");
                return;
            }
            var url = '<{:U("Pay/search")}>' + '/name/' + encodeURI(encodeURI(clientname));
            getid(url);
        });

        function getid(url) {
            $.get(url, function (result) {
                $('#searchresult').html(result);
            });
        }


        $('.reg_time').datetimepicker({
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0,

        });
        $('.reg_time').datetimepicker('update', '');

    });

</script>

