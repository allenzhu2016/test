<div class="container" style="margin-top: 81px">
</div>

<div class="container" style="margin-top: 20px">
    <div class="row">
        <div class="hidden-xs col-sm-1"></div>
        <div class="col-sm-4 col-sm-offset-2 col-xs-8">
            <div class="form-group">
                <input type="text" id="namesearch" class="form-control" id="inputPassword2" name="name"
                       placeholder="请输入客户姓名">
            </div>
        </div>
        <div class="col-sm-1 col-xs-4">
            <button id="searchclient" class="btn btn-default"><span class="fa fa-search"></span> 查询客户</button>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">
            <div id="searchresult" class="table-responsive">

            </div>
        </div>
    </div>
</div>

<!--账单填写-->
<div class="container table-ready" style="display:none;margin-top: 30px;margin-bottom:200px">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 col-xs-12">

            <form id="payform" action="<{:U('Pay/regist')}>" method="post">
                <div class="form-group">
                    <label for="exampleInputEmail1">客户编号&nbsp;&nbsp;&nbsp;<span id="clientsname"
                                                                                style="color:#00d600"></span></label>
                    <input type="text" class="form-control" id="exampleInputEmail1" name="uid" placeholder="请输入客户编号">
                </div>
                <div class="form-group">
                    <label for="">申请金额</label>
                    <input type="text" class="form-control" name="amount" id="" placeholder="请输入申请金额">
                </div>

                <div class="form-group">
                    <label for="dtp_input2" class=" control-label">Due day</label>
                    <div class="input-group date reg_time" data-date="" data-date-format="yyyy-mm-dd"
                         data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <input class="form-control" size="16" name="applytime" type="text" value="" readonly>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                    </div>
                    <input type="hidden" id="dtp_input2" value=""/><br/>
                </div>

                <div class="form-group">
                    <label for="">备注:(格式: Lot 888 Saltwater Council rate)</label>
                    <textarea class="form-control" name="remark" placeholder="请写入费用备注" rows="3"></textarea>

                </div>


                <button type="submit" class="btn btn-primary"><span class="fa fa-check"></span> 确认提交</button>
            </form>
        </div>
    </div>
</div>


<script src="__PUBLIC__/js/jquery1.11.1.min.js"></script>
<script src="__PUBLIC__/dist/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/vendor/bootstrap-validator/bootstrapValidator.min.js"></script>
<script src="__PUBLIC__/dist/js/bootstrap-datetimepicker.min.js" charset="UTF-8"></script>
<script src="__PUBLIC__/js/bootbox.min.js"></script>
<script>
    $(function () {

        $('.table-ready').fadeIn(1500);
        $('#payform').bootstrapValidator({
            fields: {
                uid: {
                    validators: {
                        notEmpty: {
                            message: '请填写客户id'
                        },
                        numeric: {
                            message: '请输入数字'
                        },
                        remote: {//ajax验证。server result:{"valid",true or false} 向服务发送当前input name值，获得一个json数据。例表示正确：{"valid",true}
                            url: '<{:U("Pay/checkid")}>',//验证地址
                            message: '您输入的客户id不存在',//提示消息
                            type: 'GET',//请求方式
                            onSuccess: function (e, data) {
                                var name = data.result.name;
                                $('#clientsname').html(name);
                            },
                            onError: function (e, data) {
                                $('#clientsname').html('');
                            }
                        }
                    }
                },
                amount: {
                    validators: {
                        notEmpty: {
                            message: '金额不能为空'
                        },
                        numeric: {
                            message: '请输入数字'
                        }
                    }
                },
                remark: {
                    validators: {
                        notEmpty: {
                            message: '用途备注不能为空'
                        },
                        stringLength: {
                            min: 3,
                            max: 200,
                            message: '用途备注请为3-200位字符'
                        }
                    }
                }
            }
        });


        $('.navbar-nav li:eq(0)').addClass('active');

        //绑定回车事件
        $(document).keydown(function (e) {
            if (e.keyCode == 13) {
                if ($('#namesearch').val()) {
                    $('#searchclient').trigger('click');
                }
            }
        })


        //查询结果绑定分页
        $('#searchresult').on('click', '.pagination li', function (e) {
            e.preventDefault();
            var url = $(this).children('a').eq(0).attr('href');
            if (url) {
                getid(url);
            }
        });


        //第一次查询
        $('#searchclient').click(function () {
            var clientname = $('#namesearch').val();
            if (!clientname || clientname == '') {
                bootbox.alert("请输入要查询的客户名字");
                return;
            }
            var url = '<{:U("Pay/search")}>' + '/name/' + encodeURI(encodeURI(clientname));
            getid(url);
        });

        function getid(url) {
            $.get(url, function (result) {
                $('#searchresult').html(result);
            });
        };

        $('.reg_time').datetimepicker({
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0,

        });
        $('.reg_time').datetimepicker('update', '');

    });

</script>

