<div id="go-top" class="iconfont icon-cc-top"></div>

<div class="container" style="margin-top: 81px;margin-bottom: 40px">


    <form role="form" id="checkform" method="post" action="<{:U('Pay/checksearch')}>">

        <div class="row">


            <div class="hidden-xs col-sm-1"></div>
            <div class="col-sm-3  col-md-2 col-xs-12" style="margin-bottom: 10px">
                <select class="selectpicker" name="query_type">
                    <option value="1"
                    <?php if(isset($query['type']) && $query['type']=='1'){echo 'selected="selected"';}?>>按客户姓名</option>
                    <option value="2"
                    <?php if(isset($query['type']) && $query['type']=='2'){echo 'selected="selected"';}?>>按备注
                    (多条件请用and隔开)</option>
                </select>
            </div>


            <div class="col-sm-offset-1 col-md-2 col-sm-3 col-md-3 col-xs-7">
                <div class="form-group">
                    <input style="width: 100%" type="text" name="query"
                           value="<?php if(isset($query['query']) && $query['query']){echo $query['query'];}?>"
                           class="form-control" placeholder="请输入搜索的信息">
                </div>
            </div>

            <div class="col-sm-1 col-md-1 col-xs-4">
                <button type="submit" class="btn btn-default"><span class="fa fa-search-minus"></span> 查询未支付</button>
            </div>

        </div>
    </form>

</div>


<!--已录入编辑-->

<div class="container" style="margin-top: 40px">

    <div class="row" style="margin-bottom: 14px">
        <div class="hidden-xs col-sm-1"></div>
        <div class="col-xs-4 col-sm-4">
            <a href="<{:U('Pay/check')}>" class="btn btn-default btn-sm"><span class="fa fa-check-circle"></span> 全部未支付</a>
        </div>
        <div class="col-xs-2 col-sm-2"></div>
        <div class="col-xs-4 col-sm-2 col-sm-offset-2 text-right">
            <button class="btn btn-default btn-sm" id="checknow"><span class=" fa fa-print"></span> Check Order</button>
        </div>
    </div>

    <div class="row table-check" style="margin-bottom:100px;display: none">
        <div class="col-sm-10 col-sm-offset-1 col-xs-12">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>客户</th>
                        <th>Ref_Num</th>
                        <th>支付金额</th>
                        <th>Due day</th>
                        <th>备注说明</th>
                        <th>录入时间</th>
                        <th>操作</th>
                        <th>选择</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php $k=0; ?>
                    <volist name="list" id="vo" empty="">
                        <?php
                            $k++;
                             if($k%2==1){
                               echo '<tr >';
                                }else{
                                echo '
                                <tr>';
                              }
                            ?>
                            <td style="width: 150px"><{$vo.name}></td>
                            <td style="width: 80px"><{$vo.referencenum}></td>
                            <td style="width: 100px">$<{$vo.amount}></td>
                            <td style="width: 150px"><{$vo.applytime|date="Y-m-d",###}></td>
                            <td style="width: 500px"><{$vo.remark}></td>
                            <td style="width: 150px"><{$vo.time|date="Y-m-d",###}></td>
                            <td style="width: 230px"><a style="margin-bottom: 10px" class="btn btn-sm btn-primary" href="<{:U('Pay/edit',array('rid'=>$vo['id']))}>"><span class="fa fa-edit"></span> 编辑</a> <a style="margin-bottom: 10px" class="delete btn btn-sm btn-default" href="<{:U('Pay/delete',array('rid'=>$vo['id']))}>"><span class="fa fa-trash"></span> 撤销</a></td>
                            <td style="width: 70px"><input type="checkbox" class="bill" name="order[]"
                                                           value="<{$vo.id}>"></td>
                        </tr>
                    </volist>

                    </tbody>
                </table>

            </div>

        </div>

    </div>


    <br>
    <!--<nav style="margin-left: 110px">-->
    <!--<ul class="pagination">-->
    <!--<{$page}>-->
    <!--</ul>-->
    <!--</nav>-->
</div>


<script src="__PUBLIC__/js/jquery1.11.1.min.js"></script>
<script src="__PUBLIC__/dist/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/vendor/bootstrap-validator/bootstrapValidator.min.js"></script>
<script src="__PUBLIC__/dist-select/js/bootstrap-select.js"></script>
<script src="__PUBLIC__/js/bootbox.min.js"></script>
<script src="__PUBLIC__/js/jQuery.base64.js"></script>
<script src="__PUBLIC__/js/jquery.goTop.js"></script>
<script>
    $('.navbar-nav li:eq(1)').addClass('active');
    $(document).ready(function () {
        $('.table-check').fadeIn(1500);
        $('#checkform').bootstrapValidator({
            fields: {
                query: {
                    validators: {
                        notEmpty: {
                            message: '请填写要查找的客户姓名'
                        },
                        stringLength: {
                            min: 2,
                            max: 15,
                            message: '名字请在2-15个字符之间~'
                        }
                    }
                }
            }
        });

        $('#checko').click(function () {
            $('#checkorderform').submit(function () {
                return true;
            })
        });


        var checkorderurl = "<{:U('Pay/order')}>";
        //bill 存在本地
        var checkorders = new Array();
        $('.bill').click(function () {
            if (this.checked == true) {
                if (parseInt(jQuery.inArray($(this).val(), checkorders)) == -1) {
                    checkorders.push($(this).val());
                }
            } else {
                if (parseInt(jQuery.inArray($(this).val(), checkorders)) !== -1) {
                    var removeItem = $(this).val();
                    checkorders = jQuery.grep(checkorders, function (value) {
                        return value != removeItem;
                    });
                }
            }
        });

//点击提交

        $('#checknow').click(function () {
            if (checkorders.length) {
                var params = $.base64Encode(checkorders.toString());
                window.open(checkorderurl + "/params/" + params, '__blank');
            } else {
                bootbox.alert('请至少选择1条数据才能生成check order喔...');
            }
        });

        $('#go-top').goTop({
            // top offset
            scrollTop: 100,
            // scroll speed in milliseconds
            scrollSpeed: 1000,
            // fade in/out speed in milliseconds
            fadeInSpeed: 1000,
            fadeOutSpeed: 500

        });

        $(".delete").click(function (event) {
            var cur = this;
            event.preventDefault();
            bootbox.confirm({
                message: "温馨提示:一经撤销不可恢复喔...",
                buttons: {
                    cancel: {
                        label: '<i class="fa fa-times"></i> 取消'
                    },
                    confirm: {
                        label: '<i class="fa fa-check"></i> 确认'
                    }
                },
                callback: function (result) { /* result is a boolean; true = OK, false = Cancel*/
                    if (result) {
                        window.location.href = $(cur).attr("href");
                    }
                }
            });
        });


    });


</script>

